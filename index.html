<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>产品目录</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#64748b',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .product-card {
                @apply bg-white rounded-lg shadow-md overflow-hidden transition-transform duration-300 hover:shadow-lg hover:-translate-y-1;
            }
            .category-item {
                @apply py-2 px-3 rounded hover:bg-primary/10 cursor-pointer transition-colors duration-200;
            }
            .category-item.active {
                @apply bg-primary text-white;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 导航栏 -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-primary">
                <i class="fa fa-shopping-bag mr-2"></i>产品目录
            </h1>
            <div class="relative">
                <input type="text" id="search-input" placeholder="搜索产品..." 
                    class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50">
                <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <div class="flex flex-col md:flex-row gap-6">
            <!-- 分类侧边栏 -->
            <div class="w-full md:w-1/4 lg:w-1/5">
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <h2 class="text-lg font-semibold mb-4 pb-2 border-b border-gray-200">产品分类</h2>
                    <ul id="category-list" class="space-y-1">
                        <!-- 分类将通过JS动态生成 -->
                    </ul>
                </div>
            </div>

            <!-- 产品列表 -->
            <div class="w-full md:w-3/4 lg:w-4/5">
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-lg font-semibold" id="products-count">所有产品</h2>
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-gray-600">排序:</span>
                            <select id="sort-select" class="border border-gray-300 rounded-md px-2 py-1 text-sm">
                                <option value="name">按名称</option>
                                <option value="price-asc">价格从低到高</option>
                                <option value="price-desc">价格从高到低</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 产品网格 -->
                <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <!-- 产品卡片将通过JS动态生成 -->
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fa fa-spinner fa-spin text-3xl mb-4"></i>
                        <p>加载产品中...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <p>&copy; 2023 产品目录网站 | 托管于 GitHub</p>
            </div>
        </div>
    </footer>

    <script>
        // 存储所有产品数据
        let allProducts = [];
        let filteredProducts = [];
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 从CSV加载产品数据
            loadProductsFromCSV();
            
            // 搜索功能
            document.getElementById('search-input').addEventListener('input', filterProducts);
            
            // 排序功能
            document.getElementById('sort-select').addEventListener('change', sortProducts);
        });
        
        // 从CSV文件加载产品数据
        function loadProductsFromCSV() {
            fetch('products.csv')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('无法加载产品数据');
                    }
                    return response.text();
                })
                .then(csvText => {
                    // 解析CSV
                    allProducts = parseCSV(csvText);
                    filteredProducts = [...allProducts];
                    
                    // 生成分类列表
                    generateCategories();
                    
                    // 渲染产品
                    renderProducts(filteredProducts);
                })
                .catch(error => {
                    document.getElementById('products-grid').innerHTML = `
                        <div class="col-span-full text-center py-12 text-red-500">
                            <i class="fa fa-exclamation-triangle text-3xl mb-4"></i>
                            <p>加载产品失败: ${error.message}</p>
                        </div>
                    `;
                    console.error('加载产品时出错:', error);
                });
        }
        
        // 解析CSV文本为对象数组
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(header => header.trim());
            const products = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;
                
                const values = lines[i].split(',').map(value => value.trim());
                const product = {};
                
                headers.forEach((header, index) => {
                    product[header] = values[index] || '';
                });
                
                products.push(product);
            }
            
            return products;
        }
        
        // 生成分类列表
        function generateCategories() {
            const categoryList = document.getElementById('category-list');
            const categories = ['全部产品', ...new Set(allProducts.map(product => product.category))];
            
            categoryList.innerHTML = categories.map(category => `
                <li>
                    <div class="category-item ${category === '全部产品' ? 'active' : ''}" 
                         data-category="${category}">
                        ${category}
                    </div>
                </li>
            `).join('');
            
            // 为分类项添加点击事件
            document.querySelectorAll('.category-item').forEach(item => {
                item.addEventListener('click', () => {
                    // 更新活跃状态
                    document.querySelectorAll('.category-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    
                    // 过滤产品
                    const category = item.getAttribute('data-category');
                    if (category === '全部产品') {
                        filteredProducts = [...allProducts];
                    } else {
                        filteredProducts = allProducts.filter(product => product.category === category);
                    }
                    
                    renderProducts(filteredProducts);
                });
            });
        }
        
        // 渲染产品列表
        function renderProducts(products) {
            const productsGrid = document.getElementById('products-grid');
            const productsCount = document.getElementById('products-count');
            
            if (products.length === 0) {
                productsGrid.innerHTML = `
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fa fa-search text-3xl mb-4"></i>
                        <p>未找到匹配的产品</p>
                    </div>
                `;
                productsCount.textContent = `找到 0 个产品`;
                return;
            }
            
            productsGrid.innerHTML = products.map(product => `
                <div class="product-card">
                    <a href="product.html?id=${product.id}" class="block">
                        <div class="h-48 bg-gray-100 overflow-hidden">
                            <img src="${product.image_url}" alt="${product.name}" 
                                 class="w-full h-full object-cover transition-transform duration-500 hover:scale-110">
                        </div>
                        <div class="p-4">
                            <div class="text-xs text-gray-500 mb-1">${product.category}</div>
                            <h3 class="font-medium text-gray-900 mb-2 line-clamp-2 h-12">${product.name}</h3>
                            <div class="flex justify-between items-center">
                                <span class="text-primary font-semibold">¥${product.price}</span>
                                <i class="fa fa-arrow-right text-gray-400"></i>
                            </div>
                        </div>
                    </a>
                </div>
            `).join('');
            
            productsCount.textContent = `找到 ${products.length} 个产品`;
        }
        
        // 过滤产品
        function filterProducts() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const activeCategory = document.querySelector('.category-item.active').getAttribute('data-category');
            
            filteredProducts = allProducts.filter(product => {
                const matchesSearch = product.name.toLowerCase().includes(searchTerm) || 
                                     product.description.toLowerCase().includes(searchTerm);
                const matchesCategory = activeCategory === '全部产品' || product.category === activeCategory;
                
                return matchesSearch && matchesCategory;
            });
            
            renderProducts(filteredProducts);
        }
        
        // 排序产品
        function sortProducts() {
            const sortBy = document.getElementById('sort-select').value;
            
            switch (sortBy) {
                case 'name':
                    filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'price-asc':
                    filteredProducts.sort((a, b) => parseFloat(a.price) - parseFloat(b.price));
                    break;
                case 'price-desc':
                    filteredProducts.sort((a, b) => parseFloat(b.price) - parseFloat(a.price));
                    break;
            }
            
            renderProducts(filteredProducts);
        }
    </script>
</body>
</html>
    